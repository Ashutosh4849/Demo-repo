{"kind":"Pod","apiVersion":"v1","metadata":{"name":"etcd","namespace":"openshift-etcd","uid":"cf539fb9-0a26-4a54-b3b0-caedd2353541","creationTimestamp":null,"labels":{"app":"etcd","etcd":"true","k8s-app":"etcd","revision":"3"}},"spec":{"volumes":[{"name":"static-pod-dir","hostPath":{"path":"/etc/kubernetes/manifests"}},{"name":"etcd-backup-dir","hostPath":{"path":"/etc/kubernetes/static-pod-resources/etcd-member"}},{"name":"resource-dir","hostPath":{"path":"/etc/kubernetes/static-pod-resources/etcd-pod-3"}},{"name":"cert-dir","hostPath":{"path":"/etc/kubernetes/static-pod-resources/etcd-certs"}},{"name":"data-dir","hostPath":{"path":"/var/lib/etcd","type":""}},{"name":"usr-local-bin","hostPath":{"path":"/usr/local/bin"}}],"initContainers":[{"name":"etcd-ensure-env-vars","image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6","command":["/bin/sh","-c","#!/bin/sh\nset -euo pipefail\n\n: \"${NODE_master01_ETCD_URL_HOST?not set}\"\n: \"${NODE_master01_ETCD_NAME?not set}\"\n: \"${NODE_master01_IP?not set}\"\n\n# check for ipv4 addresses as well as ipv6 addresses with extra square brackets\nif [[ \"${NODE_master01_IP}\" != \"${NODE_IP}\" \u0026\u0026 \"${NODE_master01_IP}\" != \"[${NODE_IP}]\" ]]; then\n  # echo the error message to stderr\n  echo \"Expected node IP to be ${NODE_IP} got ${NODE_master01_IP}\" \u003e\u00262\n  exit 1\nfi\n\n# check for ipv4 addresses as well as ipv6 addresses with extra square brackets\nif [[ \"${NODE_master01_ETCD_URL_HOST}\" != \"${NODE_IP}\" \u0026\u0026 \"${NODE_master01_ETCD_URL_HOST}\" != \"[${NODE_IP}]\" ]]; then\n  # echo the error message to stderr\n  echo \"Expected etcd url host to be ${NODE_IP} got ${NODE_master01_ETCD_URL_HOST}\" \u003e\u00262\n  exit 1\nfi\n"],"env":[{"name":"ALL_ETCD_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_API","value":"3"},{"name":"ETCDCTL_CACERT","value":"/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt"},{"name":"ETCDCTL_CERT","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt"},{"name":"ETCDCTL_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_KEY","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key"},{"name":"ETCD_CIPHER_SUITES","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"},{"name":"ETCD_DATA_DIR","value":"/var/lib/etcd"},{"name":"ETCD_ELECTION_TIMEOUT","value":"1000"},{"name":"ETCD_ENABLE_PPROF","value":"true"},{"name":"ETCD_HEARTBEAT_INTERVAL","value":"100"},{"name":"ETCD_IMAGE","value":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6"},{"name":"ETCD_INITIAL_CLUSTER_STATE","value":"existing"},{"name":"ETCD_QUOTA_BACKEND_BYTES","value":"7516192768"},{"name":"NODE_master01_ETCD_NAME","value":"master01"},{"name":"NODE_master01_ETCD_URL_HOST","value":"192.168.50.10"},{"name":"NODE_master01_IP","value":"192.168.50.10"},{"name":"NODE_master02_ETCD_NAME","value":"master02"},{"name":"NODE_master02_ETCD_URL_HOST","value":"192.168.50.11"},{"name":"NODE_master02_IP","value":"192.168.50.11"},{"name":"NODE_master03_ETCD_NAME","value":"master03"},{"name":"NODE_master03_ETCD_URL_HOST","value":"192.168.50.12"},{"name":"NODE_master03_IP","value":"192.168.50.12"},{"name":"NODE_IP","valueFrom":{"fieldRef":{"fieldPath":"status.podIP"}}}],"resources":{"requests":{"cpu":"30m","memory":"60Mi"}},"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}},{"name":"etcd-resources-copy","image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6","command":["/bin/sh","-c","#!/bin/sh\nset -euo pipefail\n\ncp /etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt /etc/kubernetes/etcd-backup-dir/system:etcd-peer-master01.crt\ncp /etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key /etc/kubernetes/etcd-backup-dir/system:etcd-peer-master01.key\nrm -f $(grep -l '^### Created by cluster-etcd-operator' /usr/local/bin/*)\ncp -p /etc/kubernetes/static-pod-certs/configmaps/etcd-scripts/*.sh /usr/local/bin\n"],"resources":{"requests":{"cpu":"30m","memory":"60Mi"}},"volumeMounts":[{"name":"etcd-backup-dir","mountPath":"/etc/kubernetes/etcd-backup-dir"},{"name":"resource-dir","mountPath":"/etc/kubernetes/static-pod-resources"},{"name":"cert-dir","mountPath":"/etc/kubernetes/static-pod-certs"},{"name":"usr-local-bin","mountPath":"/usr/local/bin"}],"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}}],"containers":[{"name":"etcdctl","image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6","command":["/bin/bash","-c","trap TERM INT; sleep infinity \u0026 wait"],"env":[{"name":"ALL_ETCD_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_API","value":"3"},{"name":"ETCDCTL_CACERT","value":"/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt"},{"name":"ETCDCTL_CERT","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt"},{"name":"ETCDCTL_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_KEY","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key"},{"name":"ETCD_CIPHER_SUITES","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"},{"name":"ETCD_DATA_DIR","value":"/var/lib/etcd"},{"name":"ETCD_ELECTION_TIMEOUT","value":"1000"},{"name":"ETCD_ENABLE_PPROF","value":"true"},{"name":"ETCD_HEARTBEAT_INTERVAL","value":"100"},{"name":"ETCD_IMAGE","value":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6"},{"name":"ETCD_INITIAL_CLUSTER_STATE","value":"existing"},{"name":"ETCD_QUOTA_BACKEND_BYTES","value":"7516192768"},{"name":"NODE_master01_ETCD_NAME","value":"master01"},{"name":"NODE_master01_ETCD_URL_HOST","value":"192.168.50.10"},{"name":"NODE_master01_IP","value":"192.168.50.10"},{"name":"NODE_master02_ETCD_NAME","value":"master02"},{"name":"NODE_master02_ETCD_URL_HOST","value":"192.168.50.11"},{"name":"NODE_master02_IP","value":"192.168.50.11"},{"name":"NODE_master03_ETCD_NAME","value":"master03"},{"name":"NODE_master03_ETCD_URL_HOST","value":"192.168.50.12"},{"name":"NODE_master03_IP","value":"192.168.50.12"}],"resources":{"requests":{"cpu":"30m","memory":"60Mi"}},"volumeMounts":[{"name":"static-pod-dir","mountPath":"/etc/kubernetes/manifests"},{"name":"etcd-backup-dir","mountPath":"/etc/kubernetes/etcd-backup-dir"},{"name":"resource-dir","mountPath":"/etc/kubernetes/static-pod-resources"},{"name":"cert-dir","mountPath":"/etc/kubernetes/static-pod-certs"},{"name":"data-dir","mountPath":"/var/lib/etcd/"}],"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent"},{"name":"etcd","image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6","command":["/bin/sh","-c","#!/bin/sh\nset -euo pipefail\n\netcdctl member list || true\n\n# this has a non-zero return code if the command is non-zero.  If you use an export first, it doesn't and you\n# will succeed when you should fail.\nETCD_INITIAL_CLUSTER=$(discover-etcd-initial-cluster \\\n  --cacert=/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt \\\n  --cert=/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt \\\n  --key=/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key \\\n  --endpoints=${ALL_ETCD_ENDPOINTS} \\\n  --data-dir=/var/lib/etcd \\\n  --target-peer-url-host=${NODE_master01_ETCD_URL_HOST} \\\n  --target-name=master01)\n export ETCD_INITIAL_CLUSTER\n\n# at this point we know this member is added.  To support a transition, we must remove the old etcd pod.\n# move it somewhere safe so we can retrieve it again later if something goes badly.\nmv /etc/kubernetes/manifests/etcd-member.yaml /etc/kubernetes/etcd-backup-dir || true\n\n# we cannot use the \"normal\" port conflict initcontainer because when we upgrade, the existing static pod will never yield,\n# so we do the detection in etcd container itsefl.\necho -n \"Waiting for ports 2379, 2380 and 9978 to be released.\"\nwhile [ -n \"$(ss -Htan '( sport = 2379 or sport = 2380 or sport = 9978 )')\" ]; do\n  echo -n \".\"\n  sleep 1\ndone\n\nexport ETCD_NAME=${NODE_master01_ETCD_NAME}\nenv | grep ETCD | grep -v NODE\n\nset -x\n# See https://etcd.io/docs/v3.4.0/tuning/ for why we use ionice\nexec ionice -c2 -n0 etcd \\\n  --initial-advertise-peer-urls=https://${NODE_master01_IP}:2380 \\\n  --cert-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-master01.crt \\\n  --key-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-master01.key \\\n  --trusted-ca-file=/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt \\\n  --client-cert-auth=true \\\n  --peer-cert-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt \\\n  --peer-key-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key \\\n  --peer-trusted-ca-file=/etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt \\\n  --peer-client-cert-auth=true \\\n  --advertise-client-urls=https://${NODE_master01_IP}:2379 \\\n  --listen-client-urls=https://0.0.0.0:2379 \\\n  --listen-peer-urls=https://0.0.0.0:2380 \\\n  --listen-metrics-urls=https://0.0.0.0:9978 ||  mv /etc/kubernetes/etcd-backup-dir/etcd-member.yaml /etc/kubernetes/manifests\n"],"env":[{"name":"ALL_ETCD_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_API","value":"3"},{"name":"ETCDCTL_CACERT","value":"/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt"},{"name":"ETCDCTL_CERT","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt"},{"name":"ETCDCTL_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_KEY","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key"},{"name":"ETCD_CIPHER_SUITES","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"},{"name":"ETCD_DATA_DIR","value":"/var/lib/etcd"},{"name":"ETCD_ELECTION_TIMEOUT","value":"1000"},{"name":"ETCD_ENABLE_PPROF","value":"true"},{"name":"ETCD_HEARTBEAT_INTERVAL","value":"100"},{"name":"ETCD_IMAGE","value":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6"},{"name":"ETCD_INITIAL_CLUSTER_STATE","value":"existing"},{"name":"ETCD_QUOTA_BACKEND_BYTES","value":"7516192768"},{"name":"NODE_master01_ETCD_NAME","value":"master01"},{"name":"NODE_master01_ETCD_URL_HOST","value":"192.168.50.10"},{"name":"NODE_master01_IP","value":"192.168.50.10"},{"name":"NODE_master02_ETCD_NAME","value":"master02"},{"name":"NODE_master02_ETCD_URL_HOST","value":"192.168.50.11"},{"name":"NODE_master02_IP","value":"192.168.50.11"},{"name":"NODE_master03_ETCD_NAME","value":"master03"},{"name":"NODE_master03_ETCD_URL_HOST","value":"192.168.50.12"},{"name":"NODE_master03_IP","value":"192.168.50.12"}],"resources":{"requests":{"cpu":"300m","memory":"600Mi"}},"volumeMounts":[{"name":"static-pod-dir","mountPath":"/etc/kubernetes/manifests"},{"name":"etcd-backup-dir","mountPath":"/etc/kubernetes/etcd-backup-dir"},{"name":"resource-dir","mountPath":"/etc/kubernetes/static-pod-resources"},{"name":"cert-dir","mountPath":"/etc/kubernetes/static-pod-certs"},{"name":"data-dir","mountPath":"/var/lib/etcd/"}],"readinessProbe":{"tcpSocket":{"port":2380},"initialDelaySeconds":3,"timeoutSeconds":5,"periodSeconds":5,"successThreshold":1,"failureThreshold":3},"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}},{"name":"etcd-metrics","image":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6","command":["/bin/sh","-c","#!/bin/sh\nset -euo pipefail\n\nexport ETCD_NAME=${NODE_master01_ETCD_NAME}\n\nexec etcd grpc-proxy start \\\n  --endpoints https://${NODE_master01_ETCD_URL_HOST}:9978 \\\n  --metrics-addr https://0.0.0.0:9979 \\\n  --listen-addr 127.0.0.1:9977 \\\n  --key /etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key \\\n  --key-file /etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-master01.key \\\n  --cert /etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt \\\n  --cert-file /etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-master01.crt \\\n  --cacert /etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt \\\n  --trusted-ca-file /etc/kubernetes/static-pod-certs/configmaps/etcd-metrics-proxy-serving-ca/ca-bundle.crt\n"],"env":[{"name":"ALL_ETCD_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_API","value":"3"},{"name":"ETCDCTL_CACERT","value":"/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt"},{"name":"ETCDCTL_CERT","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.crt"},{"name":"ETCDCTL_ENDPOINTS","value":"https://192.168.50.10:2379,https://192.168.50.12:2379,https://192.168.50.11:2379"},{"name":"ETCDCTL_KEY","value":"/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-master01.key"},{"name":"ETCD_CIPHER_SUITES","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"},{"name":"ETCD_DATA_DIR","value":"/var/lib/etcd"},{"name":"ETCD_ELECTION_TIMEOUT","value":"1000"},{"name":"ETCD_ENABLE_PPROF","value":"true"},{"name":"ETCD_HEARTBEAT_INTERVAL","value":"100"},{"name":"ETCD_IMAGE","value":"quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:ba8a5f35a37e801245248f3f4115ca6cefb11fad63c988c153aed60c3bd90ff6"},{"name":"ETCD_INITIAL_CLUSTER_STATE","value":"existing"},{"name":"ETCD_QUOTA_BACKEND_BYTES","value":"7516192768"},{"name":"NODE_master01_ETCD_NAME","value":"master01"},{"name":"NODE_master01_ETCD_URL_HOST","value":"192.168.50.10"},{"name":"NODE_master01_IP","value":"192.168.50.10"},{"name":"NODE_master02_ETCD_NAME","value":"master02"},{"name":"NODE_master02_ETCD_URL_HOST","value":"192.168.50.11"},{"name":"NODE_master02_IP","value":"192.168.50.11"},{"name":"NODE_master03_ETCD_NAME","value":"master03"},{"name":"NODE_master03_ETCD_URL_HOST","value":"192.168.50.12"},{"name":"NODE_master03_IP","value":"192.168.50.12"}],"resources":{"requests":{"cpu":"100m","memory":"200Mi"}},"volumeMounts":[{"name":"resource-dir","mountPath":"/etc/kubernetes/static-pod-resources"},{"name":"cert-dir","mountPath":"/etc/kubernetes/static-pod-certs"},{"name":"data-dir","mountPath":"/var/lib/etcd/"}],"terminationMessagePolicy":"FallbackToLogsOnError","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}}],"hostNetwork":true,"tolerations":[{"operator":"Exists"}],"priorityClassName":"system-node-critical"},"status":{}}
